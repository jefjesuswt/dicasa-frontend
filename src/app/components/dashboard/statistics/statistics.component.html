<div
  class="min-h-screen bg-[#020617] text-slate-300 font-sans selection:bg-sky-500/30 pb-12"
>
  <div
    class="sticky top-0 z-30 bg-[#020617]/90 backdrop-blur-md border-b border-white/5"
  >
    <div
      class="px-6 py-4 md:px-12 flex flex-col md:flex-row justify-between items-center gap-4"
    >
      <div>
        <h1
          class="text-xl md:text-2xl font-light text-white tracking-wide uppercase"
        >
          Dashboard <span class="font-bold text-sky-500">Operativo</span>
        </h1>
        <p class="text-[10px] text-slate-500 uppercase tracking-[0.2em] mt-1">
          Inteligencia de Negocio & Auditoría
        </p>
      </div>

      <div
        class="flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/5"
      >
        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
        <span class="text-xs text-white font-mono uppercase"
          >Sistema Online</span
        >
      </div>
    </div>
  </div>

  <div class="px-6 md:px-12 py-8 animate-fade-in">
    @if (loading()) {
    <div class="h-[50vh] flex flex-col items-center justify-center gap-4">
      <i class="pi pi-spin pi-spinner text-3xl text-sky-600"></i>
      <span class="text-xs font-mono text-slate-600 uppercase"
        >Sincronizando Datos...</span
      >
    </div>
    } @else if (stats(); as data) {
    <div class="flex flex-col gap-8">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm hover:border-sky-500/20 transition-colors group"
        >
          <div class="flex justify-between items-start mb-2">
            <span
              class="text-[10px] text-slate-500 uppercase tracking-widest font-bold"
              >Usuarios Activos</span
            >
            <i
              class="pi pi-users text-slate-700 group-hover:text-sky-500 transition-colors"
            ></i>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-3xl text-white font-light">{{
              data.kpis.activeUsers
            }}</span>
            <span class="text-xs text-emerald-500">en línea</span>
          </div>
        </div>

        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm hover:border-sky-500/20 transition-colors group"
        >
          <div class="flex justify-between items-start mb-2">
            <span
              class="text-[10px] text-slate-500 uppercase tracking-widest font-bold"
              >Tráfico Mes</span
            >
            <i
              class="pi pi-chart-bar text-slate-700 group-hover:text-sky-500 transition-colors"
            ></i>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-3xl text-white font-light">{{
              data.kpis.totalVisitsMonth | number
            }}</span>
            <span class="text-xs text-slate-500">visitas</span>
          </div>
        </div>

        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm hover:border-sky-500/20 transition-colors group"
        >
          <div class="flex justify-between items-start mb-2">
            <span
              class="text-[10px] text-slate-500 uppercase tracking-widest font-bold"
              >Permanencia</span
            >
            <i
              class="pi pi-clock text-slate-700 group-hover:text-sky-500 transition-colors"
            ></i>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-3xl text-white font-light">{{
              data.kpis.avgPermanence / 60 | number : "1.0-1"
            }}</span>
            <span class="text-xs text-slate-500">minutos</span>
          </div>
        </div>

        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm hover:border-sky-500/20 transition-colors group"
        >
          <div class="flex justify-between items-start mb-2">
            <span
              class="text-[10px] text-slate-500 uppercase tracking-widest font-bold"
              >Propiedades</span
            >
            <i
              class="pi pi-home text-slate-700 group-hover:text-sky-500 transition-colors"
            ></i>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-3xl text-white font-light">{{
              data.kpis.totalProperties
            }}</span>
            <span class="text-xs text-slate-500">totales</span>
          </div>
        </div>
      </div>

      <div
        class="bg-[#050b1d] border border-white/5 p-6 rounded-sm relative overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-sky-600 to-blue-900 opacity-30"
        ></div>
        <div class="flex justify-between items-end mb-6">
          <div>
            <h3 class="text-sm font-bold text-white uppercase tracking-widest">
              Tendencia de Usuarios
            </h3>
            <p class="text-xs text-slate-500 mt-1">
              Comportamiento de tráfico últimos 7 días
            </p>
          </div>
          <div class="text-right">
            <span class="text-2xl font-mono text-white block"
              >+{{ evolutionData.datasets[0].data[6] }}</span
            >
            <span class="text-[10px] text-emerald-500 uppercase font-bold"
              >Hoy</span
            >
          </div>
        </div>
        <div class="relative h-64 w-full">
          <canvas
            baseChart
            [data]="evolutionData"
            [type]="'line'"
            [options]="evolutionOptions"
          >
          </canvas>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm flex flex-col"
        >
          <h3
            class="text-xs font-bold text-white uppercase tracking-widest mb-6 border-l-2 border-sky-500 pl-3"
          >
            Composición de Cartera
          </h3>
          <div class="relative h-64 w-full">
            <canvas
              baseChart
              [data]="inventoryData"
              [type]="'doughnut'"
              [options]="commonOptions"
            >
            </canvas>
          </div>
        </div>

        <div
          class="bg-[#050b1d] border border-white/5 p-6 rounded-sm flex flex-col"
        >
          <div
            class="flex justify-between items-start mb-6 border-l-2 border-emerald-500 pl-3"
          >
            <h3 class="text-xs font-bold text-white uppercase tracking-widest">
              Efectividad Comercial
            </h3>
            <span
              class="text-xs font-mono text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded"
            >
              {{ data.kpis.schedulingRate }}% Éxito
            </span>
          </div>
          <div class="relative h-64 w-full">
            <canvas
              baseChart
              [data]="funnelData"
              [type]="'bar'"
              [options]="barOptions"
            >
            </canvas>
          </div>
        </div>
      </div>

      <div
        class="bg-[#050b1d] border border-white/5 rounded-sm overflow-hidden"
      >
        <div
          class="px-6 py-4 border-b border-white/5 bg-white/[0.02] flex justify-between items-center"
        >
          <h3
            class="text-xs font-bold text-slate-300 uppercase tracking-widest flex items-center gap-2"
          >
            <i class="pi pi-shield"></i> Logs de Auditoría
          </h3>
          <span class="text-[10px] text-slate-500 font-mono"
            >HTTPS: {{ data.kpis.cipherCompliance }}</span
          >
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead
              class="bg-black/20 text-[10px] text-slate-500 uppercase tracking-wider"
            >
              <tr>
                <th class="px-6 py-3 font-medium">Fecha</th>
                <th class="px-6 py-3 font-medium">Usuario ID</th>
                <th class="px-6 py-3 font-medium">Acción</th>
                <th class="px-6 py-3 font-medium text-right">Ref ID</th>
              </tr>
            </thead>
            <tbody
              class="text-xs font-mono text-slate-400 divide-y divide-white/5"
            >
              @for (log of data.security.recentLogs; track log._id) {
              <tr class="hover:bg-white/[0.02] transition-colors">
                <td class="px-6 py-3 text-slate-500 whitespace-nowrap">
                  {{ log.createdAt | date : "dd MMM, HH:mm" }}
                </td>
                <td class="px-6 py-3">
                  <span
                    class="bg-white/5 px-2 py-1 rounded text-[10px] text-sky-400"
                  >
                    {{ log.userId | slice : 0 : 8 }}...
                  </span>
                </td>
                <td class="px-6 py-3">
                  <span class="text-white font-medium">{{ log.action }}</span>
                </td>
                <td class="px-6 py-3 text-right text-slate-600">
                  {{ log._id | slice : 0 : 6 }}
                </td>
              </tr>
              } @empty {
              <tr>
                <td
                  colspan="4"
                  class="px-6 py-8 text-center text-slate-600 italic"
                >
                  No hay registros recientes.
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
    }
  </div>
</div>
