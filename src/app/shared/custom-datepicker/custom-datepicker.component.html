<div class="relative w-full font-mono text-sm group">
  <div
    (click)="toggleCalendar()"
    class="flex items-center justify-between w-full bg-white/5 border border-white/10 px-4 py-3 text-white cursor-pointer hover:bg-white/10 transition-colors"
    [class.opacity-50]="isDisabled"
  >
    <span
      [class.text-slate-500]="!selectedDate()"
      class="uppercase tracking-widest text-xs"
    >
      {{ selectedDate() ? formatDate(selectedDate()) : placeholder }}
    </span>
    <i
      class="pi pi-calendar text-slate-500 group-hover:text-sky-500 transition-colors"
    ></i>
  </div>

  @if (isOpen()) {
  <div
    class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-[9990] md:hidden"
    (click)="closeCalendar()"
  ></div>

  <div
    class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90%] max-w-[320px] z-[9999] md:absolute md:top-full md:left-0 md:translate-x-0 md:translate-y-0 md:w-full md:max-w-none bg-[#020617] border border-white/20 shadow-[0_0_50px_rgba(0,0,0,0.9)] md:shadow-[0_10px_40px_-10px_rgba(0,0,0,0.8)] p-4 animate-fadeIn rounded-sm"
  >
    <div
      class="flex justify-between items-center mb-4 pb-2 border-b border-white/10"
    >
      <button
        type="button"
        (click)="changeMonth(-1)"
        class="p-2 hover:text-sky-400 transition-colors"
      >
        <i class="pi pi-chevron-left text-xs"></i>
      </button>
      <span class="font-bold uppercase tracking-widest text-white text-xs">
        {{ currentViewDate() | date : "MMMM yyyy" : "" : "es-VE" }}
      </span>
      <button
        type="button"
        (click)="changeMonth(1)"
        class="p-2 hover:text-sky-400 transition-colors"
      >
        <i class="pi pi-chevron-right text-xs"></i>
      </button>
    </div>

    <div class="grid grid-cols-7 gap-1 mb-2 text-center">
      @for(day of ['DO','LU','MA','MI','JU','VI','SA']; track day) {
      <span class="text-[9px] text-slate-500 font-bold">{{ day }}</span>
      }
    </div>

    <div class="grid grid-cols-7 gap-1">
      @for(day of daysInMonth(); track $index) { @if(day) {
      <button
        type="button"
        (click)="selectDate(day)"
        [disabled]="isDateDisabled(day)"
        class="h-8 w-full flex items-center justify-center text-xs border border-transparent hover:border-sky-500/50 hover:bg-white/5 transition-all relative rounded-sm"
        [class.bg-sky-500]="
          selectedDate()?.toDateString() === day.toDateString()
        "
        [class.text-slate-950]="
          selectedDate()?.toDateString() === day.toDateString()
        "
        [class.font-bold]="
          selectedDate()?.toDateString() === day.toDateString()
        "
        [class.opacity-20]="isDateDisabled(day)"
        [class.cursor-not-allowed]="isDateDisabled(day)"
        [class.line-through]="isDateDisabled(day)"
      >
        {{ day.getDate() }}
      </button>
      } @else {
      <span></span>
      } }
    </div>

    <div
      class="mt-4 pt-4 border-t border-white/10 flex justify-between items-center"
    >
      <span class="text-[10px] text-slate-400 uppercase tracking-widest"
        >Hora</span
      >

      <div
        class="flex items-center gap-2 bg-white/5 border border-white/10 px-3 py-1 rounded-sm"
      >
        <div class="flex flex-col items-center">
          <button
            type="button"
            (click)="updateTime('hour', 1)"
            class="text-[8px] text-slate-400 hover:text-sky-400 py-0.5"
          >
            <i class="pi pi-chevron-up"></i>
          </button>
          <span
            class="font-bold text-white w-5 text-center text-sm font-mono"
            >{{ selectedHour() | number : "2.0" }}</span
          >
          <button
            type="button"
            (click)="updateTime('hour', -1)"
            class="text-[8px] text-slate-400 hover:text-sky-400 py-0.5"
          >
            <i class="pi pi-chevron-down"></i>
          </button>
        </div>

        <span class="text-slate-500 pb-0.5">:</span>

        <div class="flex flex-col items-center">
          <button
            type="button"
            (click)="updateTime('minute', 30)"
            class="text-[8px] text-slate-400 hover:text-sky-400 py-0.5"
          >
            <i class="pi pi-chevron-up"></i>
          </button>
          <span
            class="font-bold text-white w-5 text-center text-sm font-mono"
            >{{ selectedMinute() | number : "2.0" }}</span
          >
          <button
            type="button"
            (click)="updateTime('minute', -30)"
            class="text-[8px] text-slate-400 hover:text-sky-400 py-0.5"
          >
            <i class="pi pi-chevron-down"></i>
          </button>
        </div>
      </div>
    </div>

    <button
      type="button"
      (click)="closeCalendar()"
      class="w-full mt-5 bg-white/5 hover:bg-sky-500 hover:text-slate-950 text-sky-500 border border-white/10 text-[10px] font-bold uppercase tracking-[0.2em] py-3 transition-all active:scale-[0.98]"
    >
      Listo
    </button>
  </div>
  }
</div>
