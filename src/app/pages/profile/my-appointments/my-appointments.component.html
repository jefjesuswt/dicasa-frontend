<div class="container mx-auto px-4 py-8">
 <h2 class="text-3xl font-bold text-gray-900 mb-6">Mis Citas Programadas</h2>
@switch (loadState()) {
 @case ('loading') {
 <div class="flex justify-center items-center h-64">
 <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sky-500"></div>
 </div>
 }
 @case ('error') {
 <div class="bg-red-50 text-red-700 p-4 rounded-lg">
<p>Error al cargar tus citas. Por favor, intenta de nuevo más tarde.</p>
 </div>
}
 @case ('loaded') {
 @if (appointments().length > 0; as apps) {
      <div class="space-y-4">
 @for (appointment of appointments(); track appointment._id) {

           <p-card>
              <ng-template pTemplate="header">
                <img [src]="appointment.property.images[0] || '/assets/images/placeholder-property.png'"
                  alt="{{ appointment.property.title }}"
                  class="w-full h-48 object-cover"
                  (error)="onImageError($event)">
              </ng-template>

              <ng-template pTemplate="title">
                <a [routerLink]="['/properties', appointment.property._id]"
                   class="text-xl font-semibold text-gray-900 hover:text-sky-600 transition-colors">
                  {{ appointment.property.title }}
                </a>
              </ng-template>

              <ng-template pTemplate="subtitle">
                <p class="text-gray-600 font-medium text-lg">
                  {{ appointment.appointmentDate | date: 'fullDate' }} a las {{ appointment.appointmentDate | date: 'shortTime' }}
                </p>
              </ng-template>

              <ng-template pTemplate="content">
                <h4 class="text-sm font-medium text-gray-800 mb-2">Agente Asignado</h4>
                <div class="flex items-center space-x-3">
                  <shared-avatar class="w-6 h-6" [src]="appointment.agent.profileImageUrl" [id]="appointment.agent._id"></shared-avatar>
                  <div>
                    <p class="text-gray-900 font-medium">{{ appointment.agent.name }}</p>
                    <p class="text-sm text-gray-500">{{ appointment.agent.email }}</p>
                  </div>
                </div>
              </ng-template>

              <ng-template pTemplate="footer">
                <p-tag [value]="getStatusLabel(appointment.status)"
                       [severity]="getStatusSeverity(appointment.status)"
                       [rounded]="true">
                </p-tag>
              </ng-template>
            </p-card>
           }
 </div>
} @else {
<div class="bg-blue-50 text-blue-700 p-4 rounded-lg">
 <p>Aún no tienes citas programadas. ¡Explora nuestras propiedades!</p>
 </div>
 }
}
 }
</div>
